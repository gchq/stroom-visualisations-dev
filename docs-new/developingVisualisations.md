# Developing Visualisations

## Steps to Create a Visualisation
In order to create a new visualisation for _Stroom_ the following steps need to be taken.

### Write the Visualisation JavaScript

Create a new file for the visualisation JavaScript in upper camel case form (e.g. MyVis.js) in the directory:

`war/vis/`

See [Structure of a Visualisation Script](structureOfAVisualisationScript.md) for the basic skeleton of a visualisation script.

### Add the Visualisation to the TestVis Test Harness

In order to test the visualisation you will need to add the new visualisation script as an import in `war/index.html`. You will also need to add it to the `<select id="visType">` element so it is available for selection in the drop down.

If the visualisation has certain _settings_ values that need to be hard coded then this can be done in `war/vis/TestVis.js`.

The visualisation script will need a suitable test data set to run and this can be generated in _TestData.js_ using some common methods.

### Create the Script Entity XML File

You will need to create an entity definition file for the _Script_ in 

`stroom-content-source/`

with a name in the form `MyVis.Script.xml`. The structure of the file can be taken from `stroom-content-builder/template.Script.xml`. 

This file must define any dependencies to other scripts. For a description of how the UUIDs and dependencies work see below.

### Create the Visualisation Entity XML File

You will need to create an entity definition file for the _Visualisation_ in 

`stroom-content-source/`

with a name in the form `MyVis.Visualisation.xml`. The structure of the file can be taken from `stroom-content-builder/template.Visualisation.xml`. 

This file will need to include a dependency to the _Script_ entity created above. It will also need to define the function name that _Stroom_ will call, e.g. `visualisations.MyVis`.

### Create the Visualisation Settings JSON File

You will need to create setting JSON object for the _Script_ in 

`stroom-content-source/`

with a name in the form `MyVis.Visualisation.settings.json`. See [Visualisation Settings Structure](visualisationsSettingsStructure.md) for details on the structure of the settings file.

### Add the UUIDs to the _uuid.*_ Files

Each of the entity definition files should contain substitution tags for the UUID of the entity and the UUIDs of any dependencies. The actual UUID values are defined in the following files:

`stroom-content-builder/uuid.*`

For a new visualisation consisting of a single _Script_ and _Visualisation_ you will need to add entries of the form:

```
Script.MyVis=...

Visualisation.MyVis=...
```

Where _..._ is the value of a new UUID.  UUIDs can be generated by running _uuidgen_ in Linux.

##UUIDs, Dependencies and tags

In the various entity definition XML files, substitution tags are used in place of the hard coded values. This allows multiple instances of a content pack to be imported into _Stroom_, and means a UUID value only needs to be defined in one place.

Below is a list of the substitution tags used along with a description of what it will be substituted with.

### `@@GIT_COMMIT@@`

This tag is replaced by the latest Git commit hash for file in which it occurs.

### `@@GIT_COMMIT_TIME@@`

This tag is replaced by the latest Git commit time for the file in which it occurs.

### `@@DEPENDENCY#MyVis@@`

This tag is replaced by the UUID for the appropriate entity with name _MyVis_. E.g. if this tag is used inside a _Script_ or _Visualisation_ entity then it will refer to the following entry in the uuid.* files.

`Script.MyVis=...`

### `@@UUID@@`

This tag is replaced by the UUID for that entity.
